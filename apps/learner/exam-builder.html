<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quiz Builder - Fluent UI Style</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      :root {
        --primary-teal: #1b796c;
        --primary-teal-dark: #145a4f;
        --offwhite: #fafafa;
        --google-grey-100: #f1f3f4;
        --google-grey-200: #e8eaed;
        --google-grey-300: #dadce0;
        --google-grey-500: #9aa0a6;
        --google-grey-700: #5f6368;
        --google-grey-900: #202124;
        --google-blue: #4285f4;
        --google-green: #34a853;
        --google-red: #ea4335;
      }
      body {
        font-family: 'Google Sans', 'Roboto', sans-serif;
        background-color: var(--offwhite);
        color: var(--google-grey-900);
      }
      .question-card {
        border: 1px solid var(--google-grey-300);
      }
      .question-card.selected {
        border-color: var(--google-blue);
        box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
      }
      .fab {
        background: var(--primary-teal);
      }
      .fab:hover {
        background: var(--primary-teal-dark);
      }
      .settings-panel {
        right: -320px;
        transition: right 0.3s ease;
      }
      .settings-panel.open {
        right: 0;
      }
      .dropdown-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-in-out;
      }
      .dropdown-content.open {
        max-height: 1000px;
      }
      .forms-input:focus {
        border-bottom-color: var(--google-blue);
      }
      .forms-button {
        background: var(--primary-teal);
      }
      .forms-button:hover {
        background: var(--primary-teal-dark);
      }
      .forms-button.secondary {
        background: white;
        color: var(--google-grey-700);
        border: 1px solid var(--google-grey-300);
      }
      .forms-button.secondary:hover {
        background: var(--google-grey-100);
      }
      .mc-option .material-icons {
        color: var(--google-grey-500);
      }
      .mc-option.correct .material-icons {
        color: var(--google-green);
      }
      @keyframes pulse-red {
        0% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
        }
        70% {
          transform: scale(1.1);
          box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
        }
        100% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
        }
      }
      .missing-answer-key {
        color: var(--google-red) !important;
        border-radius: 50%;
        animation: pulse-red 1.5s infinite;
      }
      .auto-expand {
        resize: none;
        overflow: hidden;
      }
      .question-type-selector {
        display: none;
        opacity: 0;
        transform: translateY(10px);
        transition: all 0.2s ease;
      }
      .question-type-selector.show {
        display: block;
        opacity: 1;
        transform: translateY(0);
      }
    </style>
  </head>
  <body class="min-h-screen">
    <header class="bg-white border-b border-gray-200 sticky top-0 z-50">
      <div class="max-w-4xl mx-auto px-4 py-3">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-4">
            <a
              href="teacher_dashboard.html"
              class="flex items-center text-gray-500 hover:text-gray-700 transition-colors"
              title="Exit to Dashboard"
            >
              <span class="material-icons text-2xl">dashboard</span>
              <span class="hidden sm:inline text-sm ml-1">Dashboard</span>
            </a>
          </div>
          <div class="flex items-center space-x-2">
            <button id="import-questions-btn" class="forms-button secondary">
              <span class="material-icons text-sm mr-1">upload_file</span>
              Import
            </button>
            <button id="preview-btn" class="forms-button secondary">
              <span class="material-icons text-sm mr-1">visibility</span>
              Preview
            </button>
            <button id="share-btn" class="forms-button secondary">
              <span class="material-icons text-sm mr-1">share</span> Share
            </button>
            <button id="settings-btn" class="forms-button secondary">
              <span class="material-icons text-sm mr-1">settings</span> Settings
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="max-w-2xl mx-auto px-4 py-8">
      <div class="bg-white p-6 rounded-lg shadow-md mb-6">
        <textarea
          id="quiz-title"
          class="text-3xl font-bold w-full border-b-2 border-gray-200 focus:border-teal-500 outline-none pb-2 mb-4 auto-expand"
          placeholder="Untitled Quiz"
          rows="1"
        ></textarea>
        <textarea
          id="quiz-description"
          class="w-full border-b border-gray-200 focus:border-teal-500 outline-none mt-2 auto-expand"
          placeholder="Quiz description"
          rows="1"
        ></textarea>
      </div>
      <div id="questions-container" class="space-y-4">
        <div id="empty-state" class="text-center py-16">
          <div class="material-icons text-6xl text-gray-400 mb-4">quiz</div>
          <h2 class="text-2xl font-medium text-gray-600 mb-2">
            Start creating your quiz
          </h2>
          <p class="text-gray-500 mb-6">Add your first question below</p>
          <button id="add-first-question-btn" class="forms-button">
            <span class="material-icons text-sm mr-2">add</span> Add Question
          </button>
        </div>
      </div>
    </main>

    <button
      id="fab"
      class="fab fixed bottom-6 right-6 w-14 h-14 rounded-full text-white shadow-lg flex items-center justify-center"
      title="Add Question"
    >
      <span class="material-icons">add</span>
    </button>

    <div
      id="question-type-selector"
      class="question-type-selector absolute bg-white border border-gray-300 rounded-lg shadow-xl z-10 w-64"
    >
      <div class="p-2">
        <button
          class="question-type-btn w-full text-left p-3 rounded hover:bg-gray-50 flex items-center space-x-3"
          data-type="multiple-choice"
        >
          <span class="material-icons text-blue-500">radio_button_checked</span>
          <div>
            <div class="font-medium">Multiple choice</div>
            <div class="text-sm text-gray-500">Choose one answer</div>
          </div>
        </button>
        <button
          class="question-type-btn w-full text-left p-3 rounded hover:bg-gray-50 flex items-center space-x-3"
          data-type="checkboxes"
        >
          <span class="material-icons text-green-500">check_box</span>
          <div>
            <div class="font-medium">Checkboxes</div>
            <div class="text-sm text-gray-500">Choose multiple answers</div>
          </div>
        </button>
        <button
          class="question-type-btn w-full text-left p-3 rounded hover:bg-gray-50 flex items-center space-x-3"
          data-type="short-answer"
        >
          <span class="material-icons text-purple-500">short_text</span>
          <div>
            <div class="font-medium">Short answer</div>
            <div class="text-sm text-gray-500">Text response</div>
          </div>
        </button>
        <button
          class="question-type-btn w-full text-left p-3 rounded hover:bg-gray-50 flex items-center space-x-3"
          data-type="paragraph"
        >
          <span class="material-icons text-orange-500">subject</span>
          <div>
            <div class="font-medium">Paragraph</div>
            <div class="text-sm text-gray-500">Long text response</div>
          </div>
        </button>
      </div>
    </div>

    <div
      id="auto-save-indicator"
      class="fixed top-20 right-4 bg-gray-700 text-white px-3 py-2 rounded-lg shadow-lg opacity-0 transition-opacity duration-500 flex items-center space-x-2 z-10"
      style="display: none"
    ></div>

    <div
      id="settings-panel"
      class="settings-panel fixed top-0 w-80 h-full bg-white border-l border-gray-200 shadow-lg z-[1100] overflow-y-auto"
    >
      <div class="p-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-xl font-medium">Settings</h2>
          <button
            id="close-settings-btn"
            class="text-gray-500 hover:text-gray-700"
          >
            <span class="material-icons">close</span>
          </button>
        </div>
        <div class="settings-dropdown border rounded-lg mb-2">
          <button
            class="dropdown-header w-full text-left p-4 bg-gray-50 flex items-center justify-between"
          >
            <div class="flex items-center">
              <span class="material-icons mr-2">timer</span
              ><span class="font-medium">Timer</span>
            </div>
            <span class="material-icons dropdown-icon">expand_more</span>
          </button>
          <div class="dropdown-content">
            <div class="p-4 border-t">
              <div class="mb-4">
                <label class="block text-sm font-medium mb-2"
                  >Quiz Duration</label
                >
                <div class="grid grid-cols-3 gap-2">
                  <input
                    type="number"
                    id="timer-hours"
                    class="p-2 border rounded w-full text-center"
                    placeholder="H"
                    min="0"
                    value="0"
                  /><input
                    type="number"
                    id="timer-minutes"
                    class="p-2 border rounded w-full text-center"
                    placeholder="M"
                    min="0"
                    max="59"
                    value="0"
                  /><input
                    type="number"
                    id="timer-seconds"
                    class="p-2 border rounded w-full text-center"
                    placeholder="S"
                    min="0"
                    max="59"
                    value="0"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="settings-dropdown border rounded-lg">
          <button
            class="dropdown-header w-full text-left p-4 bg-gray-50 flex items-center justify-between"
          >
            <div class="flex items-center">
              <span class="material-icons mr-2">security</span
              ><span class="font-medium">Security</span>
            </div>
            <span class="material-icons dropdown-icon">expand_more</span>
          </button>
          <div class="dropdown-content">
            <div class="p-4 border-t">
              <div class="flex items-center justify-between mb-3">
                <label for="pin-protection" class="text-sm"
                  >PIN Protection</label
                ><input type="checkbox" id="pin-protection" />
              </div>
              <div id="pin-field-container" class="mb-4 hidden">
                <input
                  type="text"
                  id="quiz-pin"
                  placeholder="Enter 4-digit PIN"
                  class="w-full p-2 border rounded text-center"
                  maxlength="4"
                />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <input type="hidden" id="quizId" value="" />
    <input
      type="file"
      id="aikenFileInput"
      accept=".txt,.md,.aiken"
      style="display: none"
    />

    <script type="module">
      // Mock Supabase Client. Replace with your actual client.
      // import { supabase } from './supabaseClient.js';

      const parseAikenFormat = (content) => {
        const questions = [];
        const lines = content
          .split('\n')
          .map((line) => line.trim())
          .filter((line) => line);
        let currentQuestion = null;
        let currentOptions = [];
        for (let i = 0; i < lines.length; i++) {
          const line = lines[i];
          if (!line.match(/^[A-Z]\)|^ANSWER:/i)) {
            if (currentQuestion)
              questions.push({
                title: currentQuestion,
                options: currentOptions,
              });
            currentQuestion = line;
            currentOptions = [];
          } else if (line.match(/^[A-Z]\)/)) {
            currentOptions.push({
              text: line.substring(2).trim(),
              isCorrect: false,
            });
          } else if (line.match(/^ANSWER:/i)) {
            const answerLetter = line
              .replace(/^ANSWER:\s*/i, '')
              .trim()
              .toUpperCase();
            const answerIndex = answerLetter.charCodeAt(0) - 65;
            if (answerIndex >= 0 && answerIndex < currentOptions.length) {
              currentOptions[answerIndex].isCorrect = true;
            }
          }
        }
        if (currentQuestion)
          questions.push({ title: currentQuestion, options: currentOptions });
        return questions;
      };

      document.addEventListener('DOMContentLoaded', () => {
        let saveTimeout;
        const questionsContainer = document.getElementById(
          'questions-container'
        );
        const questionTypeSelector = document.getElementById(
          'question-type-selector'
        );
        const fab = document.getElementById('fab');
        const emptyState = document.getElementById('empty-state');
        const settingsPanel = document.getElementById('settings-panel');
        const autoSaveIndicator = document.getElementById(
          'auto-save-indicator'
        );
        const aikenInput = document.getElementById('aikenFileInput');

        const showToast = (message, type = 'info') => {
          const toast = document.createElement('div');
          const bgColor =
            type === 'error'
              ? 'bg-red-500'
              : type === 'success'
                ? 'bg-green-500'
                : 'bg-gray-700';
          toast.className = `fixed bottom-4 left-1/2 -translate-x-1/2 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50`;
          toast.textContent = message;
          document.body.appendChild(toast);
          setTimeout(() => toast.remove(), 3000);
        };

        const showSaveIndicator = (isSaving) => {
          autoSaveIndicator.style.display = 'flex';
          if (isSaving) {
            autoSaveIndicator.innerHTML = `<span class="material-icons text-sm animate-spin">sync</span><span class="text-sm font-medium ml-2">Saving...</span>`;
            autoSaveIndicator.classList.remove(
              'bg-green-100',
              'text-green-800'
            );
            autoSaveIndicator.classList.add('bg-gray-700', 'text-white');
          } else {
            autoSaveIndicator.innerHTML = `<span class="material-icons text-sm">check_circle</span><span class="text-sm font-medium ml-2">Saved</span>`;
            autoSaveIndicator.classList.remove('bg-gray-700', 'text-white');
            autoSaveIndicator.classList.add('bg-green-100', 'text-green-800');
          }
          autoSaveIndicator.classList.remove('opacity-0');
        };
        const hideSaveIndicator = () =>
          setTimeout(() => autoSaveIndicator.classList.add('opacity-0'), 2000);

        const collectQuizData = () => {
          const questions = Array.from(
            document.querySelectorAll('.question-card')
          ).map((card) => {
            return {
              title: card.querySelector('.question-title').value,
              type: card.dataset.type,
              options: Array.from(card.querySelectorAll('.mc-option')).map(
                (opt) => ({
                  text: opt.querySelector('textarea').value,
                  isCorrect: opt.classList.contains('correct'),
                })
              ),
            };
          });
          return {
            id:
              document.getElementById('quizId').value || `local-${Date.now()}`,
            title: document.getElementById('quiz-title').value,
            description: document.getElementById('quiz-description').value,
            questions: questions,
            settings: {
              time_limit:
                (parseInt(document.getElementById('timer-hours').value) || 0) *
                  3600 +
                (parseInt(document.getElementById('timer-minutes').value) ||
                  0) *
                  60 +
                (parseInt(document.getElementById('timer-seconds').value) || 0),
              pin_protection: document.getElementById('pin-protection').checked,
              quiz_pin: document.getElementById('quiz-pin').value,
            },
          };
        };

        const saveQuizToDatabase = async () => {
          showSaveIndicator(true);
          const quizData = collectQuizData();
          console.log('Saving quiz data (mock):', quizData);
          // Mock API call
          return new Promise((resolve) => {
            setTimeout(() => {
              if (!document.getElementById('quizId').value) {
                document.getElementById('quizId').value = quizData.id;
              }
              showSaveIndicator(false);
              hideSaveIndicator();
              resolve({ quiz_id: quizData.id });
            }, 1000);
          });
        };
        const triggerAutoSave = () => {
          clearTimeout(saveTimeout);
          saveTimeout = setTimeout(saveQuizToDatabase, 2000);
        };

        const autoExpand = (field) => {
          field.style.height = 'auto';
          field.style.height = field.scrollHeight + 'px';
        };

        const renderOptionsHtml = (type, data = { options: [] }) => {
          const renderOption = (opt, i, icon) => `
                    <div class="flex items-center mc-option ${opt.isCorrect ? 'correct' : ''}" data-option-id="${i}">
                        <span class="material-icons cursor-pointer">${opt.isCorrect ? (type === 'multiple-choice' ? 'radio_button_checked' : 'check_box') : type === 'multiple-choice' ? 'radio_button_unchecked' : 'check_box_outline_blank'}</span>
                        <textarea class="forms-input ml-2 auto-expand" rows="1" placeholder="Option ${i + 1}">${opt.text || ''}</textarea>
                        <button class="remove-option-btn text-gray-400 hover:text-gray-600 ml-2"><span class="material-icons">close</span></button>
                    </div>`;

          let options =
            data.options && data.options.length > 0
              ? data.options
              : [{ text: '' }];

          switch (type) {
            case 'multiple-choice':
            case 'checkboxes':
              return `<div class="options-container mt-4 space-y-2">${options.map((o, i) => renderOption(o, i, '')).join('')}</div><button class="add-option-btn text-sm text-teal-600 hover:text-teal-800 mt-2">Add option</button>`;
            case 'short-answer':
              return `<div class="mt-4"><input type="text" class="forms-input border-b-2 border-dotted" placeholder="Short answer text" disabled></div>`;
            case 'paragraph':
              return `<div class="mt-4"><textarea class="forms-input border-b-2 border-dotted auto-expand" placeholder="Long answer text" disabled rows="1"></textarea></div>`;
            default:
              return '';
          }
        };

        const addQuestion = (type, data = {}, insertAfterCard = null) => {
          emptyState.style.display = 'none';
          const card = document.createElement('div');
          card.className = 'question-card p-6';
          card.dataset.type = type;
          card.innerHTML = `
                    <div class="flex justify-between mb-4">
                        <textarea class="question-title forms-input text-lg font-medium w-full auto-expand" placeholder="Question" rows="1">${data.title || ''}</textarea>
                    </div>
                    <div class="question-content">${renderOptionsHtml(type, data)}</div>
                    <hr class="my-4">
                    <div class="flex justify-end items-center space-x-2">
                        <button class="change-type-btn forms-button secondary">Change Type <span class="material-icons text-sm ml-1">arrow_drop_down</span></button>
                        <button class="duplicate-btn text-gray-500 p-2 rounded-full"><span class="material-icons">content_copy</span></button>
                        <button class="delete-btn text-gray-500 p-2 rounded-full"><span class="material-icons">delete</span></button>
                    </div>`;
          if (insertAfterCard) insertAfterCard.after(card);
          else questionsContainer.appendChild(card);
          attachAllListeners(card);
          updateQuestionNumbers();
          card.querySelector('.question-title').focus();
          triggerAutoSave();
        };

        const updateQuestionType = (card, newType) => {
          const data = {
            title: card.querySelector('.question-title').value,
            options: Array.from(
              card.querySelectorAll('.mc-option textarea')
            ).map((t) => ({ text: t.value })),
          };
          card.dataset.type = newType;
          card.querySelector('.question-content').innerHTML = renderOptionsHtml(
            newType,
            data
          );
          attachAllListeners(card);
          triggerAutoSave();
        };

        const updateQuestionNumbers = () =>
          document.querySelectorAll('.question-card').forEach((card, index) => {
            let numEl = card.querySelector('.question-number');
            if (!numEl) {
              numEl = document.createElement('span');
              numEl.className = 'question-number font-bold mr-2';
              card.querySelector('.question-title').before(numEl);
            }
            numEl.textContent = `${index + 1}.`;
          });

        function attachAllListeners(element) {
          element.querySelectorAll('.auto-expand').forEach((field) => {
            field.addEventListener('input', () => autoExpand(field));
            autoExpand(field);
          });

          if (element.classList.contains('question-card')) {
            element.addEventListener('focusin', () => {
              document
                .querySelectorAll('.question-card.selected')
                .forEach((c) => c.classList.remove('selected'));
              element.classList.add('selected');
            });
            element
              .querySelector('.delete-btn')
              .addEventListener('click', () => {
                element.remove();
                updateQuestionNumbers();
                triggerAutoSave();
                if (questionsContainer.children.length === 1)
                  emptyState.style.display = 'block';
              });
            element
              .querySelector('.duplicate-btn')
              .addEventListener('click', () =>
                addQuestion(
                  element.dataset.type,
                  {
                    title: element.querySelector('.question-title').value,
                    options: Array.from(
                      element.querySelectorAll('.mc-option textarea')
                    ).map((t) => ({ text: t.value })),
                  },
                  element
                )
              );
            element
              .querySelector('.change-type-btn')
              .addEventListener('click', (e) => {
                e.stopPropagation();
                const rect = e.currentTarget.getBoundingClientRect();
                questionTypeSelector.style.top = `${rect.bottom + window.scrollY + 8}px`;
                questionTypeSelector.style.left = `${rect.left + window.scrollX}px`;
                questionTypeSelector.classList.add('show');
              });
          }

          element.querySelectorAll('.add-option-btn').forEach((btn) =>
            btn.addEventListener('click', (e) => {
              const card = e.target.closest('.question-card');
              const optionsContainer = card.querySelector('.options-container');
              const newIndex = optionsContainer.children.length;
              const newOptionHTML = renderOptionsHtml(card.dataset.type, {
                options: [{ text: '' }],
              })
                .match(/<div class="flex items-center mc-option.*?<\/div>/s)[0]
                .replace('Option 1', `Option ${newIndex + 1}`);
              const tempDiv = document.createElement('div');
              tempDiv.innerHTML = newOptionHTML;
              const newOptionEl = tempDiv.firstChild;
              optionsContainer.appendChild(newOptionEl);
              attachAllListeners(newOptionEl);
              newOptionEl.querySelector('textarea').focus();
            })
          );

          element
            .querySelectorAll('.remove-option-btn')
            .forEach((btn) =>
              btn.addEventListener('click', (e) =>
                e.target.closest('.mc-option').remove()
              )
            );

          element
            .querySelectorAll('.mc-option .material-icons')
            .forEach((icon) =>
              icon.addEventListener('click', (e) => {
                const card = e.target.closest('.question-card');
                const option = e.target.closest('.mc-option');
                if (card.dataset.type === 'multiple-choice') {
                  card.querySelectorAll('.mc-option').forEach((opt) => {
                    opt.classList.remove('correct');
                    opt.querySelector('.material-icons').textContent =
                      'radio_button_unchecked';
                    opt
                      .querySelector('.material-icons')
                      .classList.remove('missing-answer-key');
                  });
                  option.classList.add('correct');
                  e.target.textContent = 'radio_button_checked';
                } else if (card.dataset.type === 'checkboxes') {
                  option.classList.toggle('correct');
                  e.target.textContent = option.classList.contains('correct')
                    ? 'check_box'
                    : 'check_box_outline_blank';
                }
                triggerAutoSave();
              })
            );
        }

        document
          .getElementById('add-first-question-btn')
          .addEventListener('click', () => addQuestion('multiple-choice'));
        fab.addEventListener('click', () => addQuestion('multiple-choice'));
        document.querySelectorAll('.auto-expand').forEach((field) => {
          field.addEventListener('input', () => autoExpand(field));
          autoExpand(field);
        });
        document.body.addEventListener('input', (e) => {
          if (e.target.matches('textarea, input')) triggerAutoSave();
        });

        document
          .getElementById('settings-btn')
          .addEventListener('click', (e) => {
            e.stopPropagation();
            settingsPanel.classList.toggle('open');
          });
        document
          .getElementById('close-settings-btn')
          .addEventListener('click', () =>
            settingsPanel.classList.remove('open')
          );
        document
          .querySelectorAll('.dropdown-header')
          .forEach((h) =>
            h.addEventListener('click', () =>
              h.nextElementSibling.classList.toggle('open')
            )
          );
        document
          .getElementById('pin-protection')
          .addEventListener('change', (e) =>
            document
              .getElementById('pin-field-container')
              .classList.toggle('hidden', !e.target.checked)
          );

        document
          .getElementById('import-questions-btn')
          .addEventListener('click', () => aikenInput.click());
        aikenInput.addEventListener('change', async (e) => {
          const file = e.target.files[0];
          if (!file) return;
          const content = await file.text();
          const questions = parseAikenFormat(content);
          if (questions.length > 0) {
            questions.forEach((q) => addQuestion('multiple-choice', q));
            showToast(
              `${questions.length} questions imported successfully.`,
              'success'
            );
          } else {
            showToast('No valid questions found in the file.', 'error');
          }
          aikenInput.value = '';
        });

        questionTypeSelector.addEventListener('click', (e) => {
          const btn = e.target.closest('.question-type-btn');
          if (btn) {
            const selectedCard = document.querySelector(
              '.question-card.selected'
            );
            if (selectedCard)
              updateQuestionType(selectedCard, btn.dataset.type);
            questionTypeSelector.classList.remove('show');
          }
        });

        document.addEventListener('click', (e) => {
          if (
            !e.target.closest('.change-type-btn') &&
            !e.target.closest('#question-type-selector')
          )
            questionTypeSelector.classList.remove('show');
          if (
            !e.target.closest('#settings-panel') &&
            !e.target.closest('#settings-btn')
          )
            settingsPanel.classList.remove('open');
        });

        document
          .getElementById('preview-btn')
          .addEventListener('click', async () => {
            const res = await saveQuizToDatabase();
            if (res && res.quiz_id)
              window.open(`preview.html?quiz_id=${res.quiz_id}`, '_blank');
            else showToast('Could not save quiz for preview.', 'error');
          });

        document
          .getElementById('share-btn')
          .addEventListener('click', async () => {
            const res = await saveQuizToDatabase();
            if (res && res.quiz_id) {
              const url = `${window.location.origin}/take_quiz.html?id=${res.quiz_id}`;
              navigator.clipboard
                .writeText(url)
                .then(() =>
                  showToast('Share link copied to clipboard!', 'success')
                );
            } else {
              showToast('Could not save quiz for sharing.', 'error');
            }
          });
      });
    </script>
    <script type="module" src="src/pwa-bootstrap.js"></script>
</body>
</html>
