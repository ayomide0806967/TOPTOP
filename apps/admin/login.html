<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login | Academic Nightingale Admin</title>
    <link rel="stylesheet" href="../assets/tailwind.css" />
    <link rel="stylesheet" href="../shared/design-system.css" />
    <script>
      // Supabase client config for OAuth
      window.__SUPABASE_CONFIG__ = window.__SUPABASE_CONFIG__ || {
        url: 'https://ghnhfagydcynhkgbazbj.supabase.co',
        anonKey:
          'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdobmhmYWd5ZGN5bmhrZ2JhemJqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwMDM2MjQsImV4cCI6MjA3NDU3OTYyNH0.KHgZ_ESTneR0CqWBGfu-JOmI3eBBLCZr1XG-g2vpclw',
      };
    </script>
</head>
<body>
    <!-- Login container will be loaded from shared component -->
    <div id="app-root"></div>

    <!-- Load authentication services -->
    <script type="module">
        import { authService } from '../shared/auth.js';
        import { appInitializer } from '../shared/appInitializer.js';

        // Initialize app
        await appInitializer.initialize();

        // Load login component
        try {
            const response = await fetch('../shared/login-component.html');
            const html = await response.text();
            document.getElementById('app-root').innerHTML = html;

            // Update page title for admin context
            document.title = 'Login | Academic Nightingale Admin';
            const subtitle = document.querySelector('#login-container p.text-gray-600');
            if (subtitle) {
                subtitle.textContent = 'Sign in to your admin account';
            }

            // Check if user is already authenticated
            if (authService.isAuthenticated()) {
                const url = new URL(window.location.href);
                const redirectParam = url.searchParams.get('redirect');
                if (redirectParam) {
                    window.location.href = redirectParam;
                } else {
                    const user = authService.getCurrentUser();
                    const dashboardRoutes = {
                        super_admin: '/super-admin/dashboard',
                        instructor: '/instructor/dashboard',
                        student: '/student/dashboard'
                    };
                    const redirectRoute = dashboardRoutes[user?.role] || '/instructor/dashboard';
                    window.location.href = redirectRoute;
                }
            }
        } catch (error) {
            console.error('Failed to load login component:', error);
            // Fallback content
            document.getElementById('app-root').innerHTML = `
                <div class="min-h-screen bg-brand-light flex items-center justify-center p-4">
                    <div class="card p-8 text-center">
                        <h1 class="text-xl font-semibold text-red-600 mb-2">Loading Error</h1>
                        <p class="text-gray-600">Please refresh the page to try again.</p>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>